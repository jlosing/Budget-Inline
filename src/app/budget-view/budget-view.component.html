<div class="container">
  <h2 class="text-center">My Budget</h2>

  @if (userBudget?.budgetId) {
  <p>Budget ID: {{ userBudget?.budgetId }}</p>
  } @if(userBudget?.name) {
  <p>Budget Name: {{ userBudget?.name }}</p>
  } @if(userBudget?.uid) {
  <p>User ID (owner): {{ userBudget?.uid }}</p>
  } @if (userBudget && userBudget.categories) {
  <h4>Budget Categories:</h4>
  <ul class="list-group d-inline-flex">
    @for (categoryItem of (userBudget.categories | keyvalue); track
    categoryItem.key) {
    <li class="list-group-item">
      <div class="d-flex justify-content-between align-items-center">
        <span>
          {{ categoryItem.key }}:
          {{ categoryItem.value }}
        </span>
        <div>
          <button class="btn btn-sm btn-outline-secondary me-2">
            Edit Category
          </button>
          <button
            class="btn btn-sm btn-success"
            (click)="openAddTransactionModal(categoryItem.key)"
          >
            + Add Transaction
          </button>
        </div>
      </div>

      <div class="mt-2">
        <h5>Transactions for {{ categoryItem.key }}:</h5>
        @if (getTransactionsForCategory(categoryItem.key).length > 0) { @for
        (transaction of getTransactionsForCategory(categoryItem.key); track
        transaction.id) {
        <div class="card my-1 p-2">
          <p class="mb-0"><strong>Name:</strong> {{ transaction.name }}</p>
          <p class="mb-0">
            <strong>Amount:</strong>
            {{ transaction.amount | currency }}
          </p>
        </div>
        } } @else {
        <p class="text-muted">No transactions for this category yet.</p>
        }
      </div>
    </li>
    }
    <li class="list-group-item">
      <div class="d-flex justify-content-center align-items-center">
        <button class="btn btn-outline-secondary">Add Category</button>
      </div>
    </li>
  </ul>
  } @else if (userBudget && !userBudget.categories) {
  <p>This budget does not have any specific categories defined.</p>
  } @else if (!userBudget && !isLoadingBudget) {
  <p>No budget found for this user, or budget is still loading.</p>
  } @if (isLoadingBudget) {
  <p>Loading budget...</p>
  } @if (showAddTransactionModal) {
  <div class="modal-overlay" (click)="closeAddTransactionModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="btn-close-modal" (click)="closeAddTransactionModal()">
        X
      </button>
      <app-add-transaction
        [inputCategory]="selectedCategoryForNewTransaction"
        [inputId]="userId ?? undefined"
        (transactionAdded)="handleTransactionAdded()"
        (closeModal)="closeAddTransactionModal()"
      >
      </app-add-transaction>
    </div>
  </div>
  }
</div>
