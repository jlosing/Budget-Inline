<div class="container">
  <h2 class="text-center">My Budget</h2>

  @if (userBudget?.budgetId) {
  <p>Budget ID: {{ userBudget?.budgetId }}</p>
  } @if(userBudget?.name) {
  <p>Budget Name: {{ userBudget?.name }}</p>
  } @if(userBudget?.uid) {
  <p>User ID (owner): {{ userBudget?.uid }}</p>
  } @if (userBudget && userBudget.categories) {
  <h4>Budget Categories:</h4>
  <ul class="list-group d-inline-flex">
    @for (categoryItem of (userBudget.categories | keyvalue); track
    categoryItem.key) {
    <li class="list-group-item">
      <div class="d-flex justify-content-between align-items-center">
        <span>
          {{ categoryItem.key }}:
          {{ categoryItem.value }}
        </span>
        <div>
          <button class="btn btn-sm btn-outline-secondary me-2">
            Edit Category
          </button>
          <button
            class="btn btn-sm btn-success"
            (click)="openAddTransactionModal(categoryItem.key)"
          >
            + Add Transaction
          </button>
        </div>
      </div>

      <div class="mt-2">
        <h5>Transactions for {{ categoryItem.key }}:</h5>
        @if (getTransactionsForCategory(categoryItem.key).length > 0) { @for
        (transaction of getTransactionsForCategory(categoryItem.key); track
        transaction.id) {
        <div class="card my-1 p-2">
          <p class="mb-0"><strong>Name:</strong> {{ transaction.name }}</p>
          <p class="mb-0">
            <strong>Amount:</strong>
            {{ transaction.amount | currency }}
          </p>
        </div>
        } } @else {
        <p class="text-muted">No transactions for this category yet.</p>
        }
      </div>
    </li>
    }
  </ul>
  } @else if (userBudget && !userBudget.categories) {
  <p>This budget does not have any specific categories defined.</p>
  } @else if (!userBudget && !isLoadingBudget) {
  <p>No budget found for this user, or budget is still loading.</p>
  } @if (isLoadingBudget) {
  <p>Loading budget...</p>
  } @if (showAddTransactionModal) {
  <div class="modal-overlay" (click)="closeAddTransactionModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <button class="btn-close-modal" (click)="closeAddTransactionModal()">
        X
      </button>
      <app-add-transaction
        [inputCategory]="selectedCategoryForNewTransaction"
        (transactionAdded)="handleTransactionAdded()"
        (closeModal)="closeAddTransactionModal()"
      >
      </app-add-transaction>
    </div>
  </div>
  }
</div>

<style>
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black overlay */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000; /* Ensure it's on top */
  }
  .modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    min-width: 300px; /* Or your desired width */
    max-width: 90%;
    position: relative; /* For positioning the close button */
  }
  .btn-close-modal {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
  }
</style>
